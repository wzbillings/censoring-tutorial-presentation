<!DOCTYPE html>
<html lang="en"><head>
<script src="main_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_files/libs/quarto-html/tabby.min.js"></script>
<script src="main_files/libs/quarto-html/popper.min.js"></script>
<script src="main_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="main_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="main_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="main_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.24">

  <meta name="author" content="Zane Billings">
  <meta name="dcterms.date" content="2024-04-15">
  <title>Linear models and censored data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="main_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="main_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="main_files/libs/revealjs/dist/theme/quarto.css">
  <link href="main_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="main_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="main_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="main_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Linear models and censored data</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Zane Billings 
</div>
</div>
</div>

  <p class="date">2024-04-15</p>
</section>
<section id="censored-data-are-partially-known." class="slide level2">
<h2>Censored data are partially known.</h2>
<ul>
<li>In general if a data point <span class="math inline">\(x\)</span> is censored, we don’t know the exact value of <span class="math inline">\(x\)</span>, but we know that <span class="math inline">\(x \in \left(x_L, x_U\right)\)</span>.</li>
<li>The most common example in epidemiology is a time-to-event outcome in survival analysis.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/right%20censored%20example%20figure-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Participants 2, 6, and 10 have event times in <span class="math inline">\(\left[\text{May 16}, \infty\right).\)</span></li>
<li>If we just throw those people out, or count their event date as May 16, we bias the distribution of event times to be overall lower. This could make our study results better or worse depending on context.</li>
<li>Called <strong>right censored</strong> data because the RIGHT endpoint of the interval is unknown.</li>
</ul>
<h3 id="lab-assays-are-also-commonly-censored.">Lab assays are also commonly censored.</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/left%20censoring%20example-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Immunological measurements often have a lower limit to the titer that can be accurately measured. (The lower limit of detection, LoD.)</li>
<li>In this plot, if the true (“latent”) antibody titer is less than 2 is recorded as 2. Although those values are really in <span class="math inline">\((0, 2]\)</span> on the natural scale, or <span class="math inline">\((-\infty, 1]\)</span> on the log scale.</li>
<li>So the LoD measurements are <strong>left censored</strong> because the left endpoint of the interval is unknown.</li>
</ul>
<h3 id="data-can-be-simultaneously-left-and-right-censored.">Data can be simultaneously left and right censored.</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/left%20and%20right%20censoring%20example-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The same assay can have both a lower limit and an upper limit of detection, so a variable can contain left censored and right censored values.</li>
<li>However, a specific observation can only be left censored or right censored.</li>
</ul>
<h3 id="interval-censoring-provides-a-more-general-framework.">Interval censoring provides a more general framework.</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/interval%20censoring%20example-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Under <strong>interval censoring</strong>, there are a discrete number of possible values we can observe, even though the underlying quantity of interest is continuous.</li>
<li>Influenza HAI titer and other serial dilution assays are often interval censored.</li>
<li>Many interval-censored assays also have limits of detection, like the one shown here.</li>
</ul>
<h3 id="for-example-hai-titers-have-a-lower-lod-and-are-interval-censored.">For example, HAI titers have a lower LoD and are interval censored.</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/HAI%20example-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="censored-data-biases-models." class="slide level2">
<h2>Censored data biases models.</h2>
<ul>
<li>Consider the simple example of a standard normal random variable, <span class="math inline">\(z \overset{\mathrm{iid}}{\sim} \text{Normal}(0, 1)\)</span>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">8980</span>)</span>
<span id="cb1-2"><a href=""></a>simple_ex <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb1-3"><a href=""></a>    <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb1-4"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We know that if we estimate the mean and variance using the normal methods, we’ll get an asymptotically good estimate as <span class="math inline">\(n \to \infty\)</span>.</li>
<li>What happens if we impose a lower limit of detection at, say, <span class="math inline">\(z = -1\)</span>? We can write this as</li>
</ul>
<p><span class="math display">\[
Y_i = \begin{cases}
-1, &amp; Z_i &lt; -1 \\
Z_i, &amp; Z_i \geq -1
\end{cases}.
\]</span></p>
<ul>
<li>And then simulate the censoring.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a>simple_ex <span class="ot">&lt;-</span> simple_ex <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-3"><a href=""></a>        <span class="at">lod =</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">times =</span> <span class="dv">1000</span>),</span>
<span id="cb2-4"><a href=""></a>        <span class="at">y =</span> <span class="fu">ifelse</span>(z <span class="sc">&lt;</span> lod, lod, z)</span>
<span id="cb2-5"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The distributions are clearly different.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">ggplot</span>(simple_ex) <span class="sc">+</span></span>
<span id="cb3-2"><a href=""></a>    <span class="fu">geom_histogram</span>(</span>
<span id="cb3-3"><a href=""></a>        <span class="fu">aes</span>(<span class="at">x =</span> z, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> <span class="st">"latent"</span>),</span>
<span id="cb3-4"><a href=""></a>        <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb3-5"><a href=""></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb3-6"><a href=""></a>        <span class="at">binwidth =</span> <span class="fl">0.1</span></span>
<span id="cb3-7"><a href=""></a>    ) <span class="sc">+</span></span>
<span id="cb3-8"><a href=""></a>    <span class="fu">geom_histogram</span>(</span>
<span id="cb3-9"><a href=""></a>        <span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> <span class="st">"observed"</span>),</span>
<span id="cb3-10"><a href=""></a>        <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb3-11"><a href=""></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb3-12"><a href=""></a>        <span class="at">binwidth =</span> <span class="fl">0.1</span></span>
<span id="cb3-13"><a href=""></a>    ) <span class="sc">+</span></span>
<span id="cb3-14"><a href=""></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb3-15"><a href=""></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E69F0050"</span>, <span class="st">"#56B4E950"</span>),</span>
<span id="cb3-16"><a href=""></a>        <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb3-17"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/simple%20example%20plot-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The standard MLE (assuming a normal distribution) doesn’t work.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>simple_ex <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lod) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href=""></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">c</span>(z, y)) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb4-5"><a href=""></a>        <span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb4-6"><a href=""></a>        <span class="at">variance =</span> <span class="fu">var</span>(value),</span>
<span id="cb4-7"><a href=""></a>        <span class="at">.by =</span> <span class="fu">c</span>(name)</span>
<span id="cb4-8"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb4-10"><a href=""></a>        <span class="at">variable =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"z"</span>, <span class="st">"latent"</span>, <span class="st">"censored"</span>),</span>
<span id="cb4-11"><a href=""></a>        <span class="at">.keep =</span> <span class="st">"unused"</span>,</span>
<span id="cb4-12"><a href=""></a>        <span class="at">.before =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb4-13"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-14"><a href=""></a>    tibble<span class="sc">::</span><span class="fu">add_row</span>(</span>
<span id="cb4-15"><a href=""></a>        <span class="at">variable =</span> <span class="st">"truth"</span>,</span>
<span id="cb4-16"><a href=""></a>        <span class="at">mean =</span> <span class="dv">0</span>,</span>
<span id="cb4-17"><a href=""></a>        <span class="at">variance =</span> <span class="dv">1</span>,</span>
<span id="cb4-18"><a href=""></a>        <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb4-19"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a href=""></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">variance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">truth</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">latent</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">0.929</td>
</tr>
<tr class="odd">
<td style="text-align: left;">censored</td>
<td style="text-align: right;">0.117</td>
<td style="text-align: right;">0.717</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>We can see that the mean is overestimated and the variance is underestimated.</li>
<li>If we did standard <span class="math inline">\(t\)</span>-tests for the mean, and <span class="math inline">\(\chi^2\)</span>-test for the variance, we would get that the latent variable gives the correct decision (fail to reject), while the censored variable would reject both.</li>
<li>As the proportion of data that are censored increases, the bias gets worse (proof not shown, but true in general).</li>
</ul>
<div style="font-size: 50%;">
<ul>
<li>Mean estimate: <span class="math inline">\(\bar{x} = \frac{1}{n} \sum_{i=1}^nx_i\)</span>.</li>
<li>Var estimate: <span class="math inline">\(s^2_x = \frac{1}{n-1}\sum_{i=1}^n\left(x_i-\bar{x}\right)^2\)</span>.</li>
</ul>
</div>
</section>
<section id="how-do-we-fix-it" class="slide level2">
<h2>How do we fix it?</h2>
<ul>
<li>We need to modify the likelihood. Recall that for a parametric model assuming mutually independent observations, the likelihood of the sample is</li>
</ul>
<p><span class="math display">\[
\mathcal{L}(\vec{\theta} \mid \vec{x}) = \prod_{i=1}^n f_X\left(x_i \mid \vec{\theta}\right)
\]</span></p>
<p>where <span class="math inline">\(f_X\)</span> is the probability density function of random variable <span class="math inline">\(X\)</span> imposed by some parametric model.</p>
<ul>
<li>This is easy to do for our latent variable. Since we know what the normal PDF looks like, we can write</li>
</ul>
<p><span class="math display">\[
\mathcal{L}\left( \begin{bmatrix}\mu \\ \sigma\end{bmatrix} \mid \vec{z}\right) = \prod_{i=1}^n \frac{1}{\sigma\sqrt{2\pi}}\exp\left(-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2\right),
\]</span> and we simultaneously maximize (or typically minimize the negative log-likelihood) over both <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>.</p>
<ul>
<li>Two paths from here: add priors and sample from the posterior distribution of <span class="math inline">\(\vec{\theta}\)</span>, or find the argmax w.r.t. <span class="math inline">\(\vec{\theta}\)</span>.</li>
</ul>
<h3 id="its-a-bit-harder-for-censored-data.">It’s a bit harder for censored data.</h3>
<ul>
<li>For our censored problem, we first need to write out the pdf.</li>
<li>Let <span class="math inline">\(C_i\)</span> be an indicator for whether <span class="math inline">\(Z_i\)</span> is censored, that is,</li>
</ul>
<p><span class="math display">\[
C_i = \begin{cases}
1, &amp; Z_i &lt; -1 \\
0, &amp; Z_i \geq -1
\end{cases}.
\]</span></p>
<ul>
<li>The central observation we need to make is that (skipping over technical issues with the point probability of a continuous R.V.)</li>
</ul>
<p><span class="math display">\[
\mathrm{Pr}\left(Y_i =-1\right) = \mathrm{Pr}\left(Z_i \leq -1\right)=\int_{-\infty}^{-1}f_{Z}\left(y_i \mid \vec{\theta}\right)\ dy_i = F_Z\left(-1 \mid \vec{\theta}\right).
\]</span></p>
<ul>
<li>This induces a point mass in the probability distribution of <span class="math inline">\(Y\)</span>.</li>
<li>Joke about the Lesbegue decomposition theorem</li>
<li>Using the indicator <span class="math inline">\(C\)</span>, we can write the likelihood of <span class="math inline">\(Y_i\)</span> as</li>
</ul>
<p><span class="math display">\[
\mathcal{L}\left(y_i \mid \vec{\theta}\right) = f_Z\left(y_i \mid \vec{\theta}\right)^{c_i - 1} \cdot F_Z\left(-1 \mid \vec{\theta}\right)^{c_i}.
\]</span></p>
<ul>
<li>Now, we could maximize the censored data likelihood ourselves.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a>ex_ll <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma, x, L) {</span>
<span id="cb5-2"><a href=""></a>    vals <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb5-3"><a href=""></a>        x <span class="sc">&gt;</span> L,</span>
<span id="cb5-4"><a href=""></a>        <span class="fu">dnorm</span>(x, mu, sigma, <span class="at">log =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-5"><a href=""></a>        <span class="fu">pnorm</span>(L, mu, sigma, <span class="at">log.p =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-6"><a href=""></a>    )</span>
<span id="cb5-7"><a href=""></a>    </span>
<span id="cb5-8"><a href=""></a>    out <span class="ot">&lt;-</span> <span class="fu">sum</span>(vals)</span>
<span id="cb5-9"><a href=""></a>    <span class="fu">return</span>(out)</span>
<span id="cb5-10"><a href=""></a>}</span>
<span id="cb5-11"><a href=""></a></span>
<span id="cb5-12"><a href=""></a>simple_ll <span class="ot">&lt;-</span></span>
<span id="cb5-13"><a href=""></a>    tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(</span>
<span id="cb5-14"><a href=""></a>        <span class="at">mu =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">0.01</span>),</span>
<span id="cb5-15"><a href=""></a>        <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="fl">0.01</span>)</span>
<span id="cb5-16"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-17"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-18"><a href=""></a>        <span class="at">ll =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(</span>
<span id="cb5-19"><a href=""></a>            mu, sigma,</span>
<span id="cb5-20"><a href=""></a>            \(m, s) <span class="fu">ex_ll</span>(m, s, <span class="at">x =</span> simple_ex<span class="sc">$</span>y, <span class="at">L =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb5-21"><a href=""></a>        )</span>
<span id="cb5-22"><a href=""></a>    )</span>
<span id="cb5-23"><a href=""></a></span>
<span id="cb5-24"><a href=""></a>simple_ll <span class="sc">|&gt;</span></span>
<span id="cb5-25"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">slice_max</span>(ll) <span class="sc">|&gt;</span></span>
<span id="cb5-26"><a href=""></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: right;">mu</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">ll</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">-1340.695</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>There are also built in methods in base R (specifically the <code>survival</code>) package which implement this likelihood adjustment for us.</li>
<li>This is more convenient cause we can easily get CIs and other statistical stuff, but we have to use the insane syntax of <code>survival</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>surv_fit <span class="ot">&lt;-</span> survival<span class="sc">::</span><span class="fu">survreg</span>(</span>
<span id="cb6-2"><a href=""></a>    survival<span class="sc">::</span><span class="fu">Surv</span>(y, y <span class="sc">&gt;</span> lod, <span class="at">type =</span> <span class="st">"left"</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb6-3"><a href=""></a>    <span class="at">data =</span> simple_ex,</span>
<span id="cb6-4"><a href=""></a>    <span class="at">dist =</span> <span class="st">"gaussian"</span></span>
<span id="cb6-5"><a href=""></a>)</span>
<span id="cb6-6"><a href=""></a></span>
<span id="cb6-7"><a href=""></a>surv_est <span class="ot">&lt;-</span></span>
<span id="cb6-8"><a href=""></a>    broom<span class="sc">::</span><span class="fu">tidy</span>(surv_fit) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb6-10"><a href=""></a>        <span class="at">term =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span>, <span class="st">"mean"</span>, <span class="st">"variance"</span>),</span>
<span id="cb6-11"><a href=""></a>        <span class="at">lwr =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb6-12"><a href=""></a>        <span class="at">upr =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb6-13"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-14"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(term, estimate, lwr, upr) <span class="sc">|&gt;</span></span>
<span id="cb6-15"><a href=""></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb6-16"><a href=""></a></span>
<span id="cb6-17"><a href=""></a>surv_est[<span class="dv">2</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">exp</span>(surv_est[<span class="dv">2</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb6-18"><a href=""></a>knitr<span class="sc">::</span><span class="fu">kable</span>(surv_est, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">lwr</th>
<th style="text-align: right;">upr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mean</td>
<td style="text-align: right;">0.049</td>
<td style="text-align: right;">-0.012</td>
<td style="text-align: right;">0.109</td>
</tr>
<tr class="even">
<td style="text-align: left;">variance</td>
<td style="text-align: right;">0.960</td>
<td style="text-align: right;">0.914</td>
<td style="text-align: right;">1.008</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>We can also easily fit the model in a Bayesian framework using <code>brms</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a>brms_dat <span class="ot">&lt;-</span> simple_ex</span>
<span id="cb7-2"><a href=""></a>brms_dat<span class="sc">$</span>c <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(brms_dat<span class="sc">$</span>z <span class="sc">&lt;</span> brms_dat<span class="sc">$</span>lod, <span class="st">"left"</span>, <span class="st">"none"</span>)</span>
<span id="cb7-3"><a href=""></a></span>
<span id="cb7-4"><a href=""></a>brms_fit <span class="ot">&lt;-</span></span>
<span id="cb7-5"><a href=""></a>    brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb7-6"><a href=""></a>        <span class="at">formula =</span> y <span class="sc">|</span> <span class="fu">cens</span>(c) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb7-7"><a href=""></a>        <span class="at">data =</span> brms_dat,</span>
<span id="cb7-8"><a href=""></a>        <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb7-9"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.000226 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2.26 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 0.522 seconds (Warm-up)
Chain 1:                0.573 seconds (Sampling)
Chain 1:                1.095 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.000451 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 4.51 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 0.542 seconds (Warm-up)
Chain 2:                0.511 seconds (Sampling)
Chain 2:                1.053 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.000139 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 1.39 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 0.533 seconds (Warm-up)
Chain 3:                0.56 seconds (Sampling)
Chain 3:                1.093 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.000122 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 1.22 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 0.532 seconds (Warm-up)
Chain 4:                0.591 seconds (Sampling)
Chain 4:                1.123 seconds (Total)
Chain 4: </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a><span class="fu">summary</span>(brms_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y | cens(c) ~ 1 
   Data: brms_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.05      0.03    -0.01     0.11 1.00     2811     2246

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.96      0.02     0.92     1.01 1.00     3375     2695

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="example-1-hai" class="slide level2">
<h2>Example 1: HAI</h2>
<ul>
<li>In this example, I’ll discuss one of my current research interests and work through an example with predictors.</li>
<li>We’ll also discuss a model with a ratio of censored variables as the outcome.</li>
</ul>
<h3 id="ugafluvac-data-description">UGAFluVac data description</h3>
<ul>
<li>Data from Ted Ross, collected at three study sites (PA, FL, and UGA) between September 2014 and April 2017. All individuals received a vaccine containing A/H1N1/California/NUMBER/2009-like virus.</li>
<li>Each individual gave a study sample before vaccination and 21 days after. Lab workers did HAI assays against a large panel of historical strains.</li>
<li>We calculated the antigenic distance between each historical strain and the vaccine strain, so we have an “antibody landscape” for each individual in the study.</li>
<li>For the purpose of this analysis, we ignore repeated measurements of the same individual in subsequent years and pretend they are new people.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb11-2"><a href=""></a>sampled_ids <span class="ot">&lt;-</span> <span class="fu">sample</span>(hai_dat<span class="sc">$</span>uniq_id <span class="sc">|&gt;</span> <span class="fu">unique</span>(), <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb11-3"><a href=""></a></span>
<span id="cb11-4"><a href=""></a>hai_dat <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(uniq_id <span class="sc">%in%</span> sampled_ids) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href=""></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-7"><a href=""></a>    <span class="fu">aes</span>(<span class="at">x =</span> norm_dist, <span class="at">y =</span> <span class="dv">2</span> <span class="sc">^</span> posttiter, <span class="at">group =</span> id, <span class="at">color =</span> <span class="fu">factor</span>(id)) <span class="sc">+</span></span>
<span id="cb11-8"><a href=""></a>    <span class="fu">geom_line</span>(</span>
<span id="cb11-9"><a href=""></a>        <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb11-10"><a href=""></a>    ) <span class="sc">+</span></span>
<span id="cb11-11"><a href=""></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href=""></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb11-13"><a href=""></a>        <span class="at">trans =</span> <span class="st">"log2"</span>,</span>
<span id="cb11-14"><a href=""></a>        <span class="at">breaks =</span> <span class="dv">2</span> <span class="sc">^</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb11-15"><a href=""></a>        <span class="at">labels =</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">^</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb11-16"><a href=""></a>    ) <span class="sc">+</span></span>
<span id="cb11-17"><a href=""></a>    <span class="fu">labs</span>(</span>
<span id="cb11-18"><a href=""></a>        <span class="at">y =</span> <span class="st">"Post-vaccination HAI titer"</span>,</span>
<span id="cb11-19"><a href=""></a>        <span class="at">x =</span> <span class="st">"Normalized antigenic distance"</span>,</span>
<span id="cb11-20"><a href=""></a>        <span class="at">title =</span> <span class="st">"Antibody landscape for 10 randomly sampled individuals"</span></span>
<span id="cb11-21"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/hai%20plot-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Instead of looking at this as a trajectory, we can also just make a scatter plot since random and group effects are beyond today’s discussion.</p></li>
<li><p>HAI titer is a serial dilution assay with a limit of detection at 5, so it has both interval censoring and left censoring (which defines a specific interval into which the outcome can be censored).</p></li>
<li><p>Even with just a basic estimate of the mean post-titer value, adjusting for the different types of censoring makes a difference.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a>hai_mean_naive <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href=""></a>    hai_dat <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">mean_cl_boot</span>(posttiter)) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), hai_inverse)) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"Naive"</span>, <span class="at">.before =</span> <span class="fu">everything</span>())</span>
<span id="cb12-6"><a href=""></a></span>
<span id="cb12-7"><a href=""></a>surv_fit_hai_simple <span class="ot">&lt;-</span></span>
<span id="cb12-8"><a href=""></a>    survival<span class="sc">::</span><span class="fu">survreg</span>(</span>
<span id="cb12-9"><a href=""></a>        survival<span class="sc">::</span><span class="fu">Surv</span>(posttiter, posttiter <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">type =</span> <span class="st">'left'</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-10"><a href=""></a>        <span class="at">data =</span> hai_dat,</span>
<span id="cb12-11"><a href=""></a>        <span class="at">dist =</span> <span class="st">"gaussian"</span></span>
<span id="cb12-12"><a href=""></a>    )</span>
<span id="cb12-13"><a href=""></a></span>
<span id="cb12-14"><a href=""></a>hai_mean_lod <span class="ot">&lt;-</span></span>
<span id="cb12-15"><a href=""></a>    broom<span class="sc">::</span><span class="fu">tidy</span>(surv_fit_hai_simple, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-16"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-17"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-18"><a href=""></a>        <span class="at">y =</span> <span class="fu">hai_inverse</span>(estimate),</span>
<span id="cb12-19"><a href=""></a>        <span class="at">ymin =</span> <span class="fu">hai_inverse</span>(conf.low),</span>
<span id="cb12-20"><a href=""></a>        <span class="at">ymax =</span> <span class="fu">hai_inverse</span>(conf.high),</span>
<span id="cb12-21"><a href=""></a>        <span class="at">.keep =</span> <span class="st">"none"</span></span>
<span id="cb12-22"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-23"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"LoD only"</span>, <span class="at">.before =</span> <span class="fu">everything</span>())</span>
<span id="cb12-24"><a href=""></a></span>
<span id="cb12-25"><a href=""></a>hai_dat_interval <span class="ot">&lt;-</span></span>
<span id="cb12-26"><a href=""></a>    hai_dat <span class="sc">|&gt;</span></span>
<span id="cb12-27"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-28"><a href=""></a>        <span class="at">post_min =</span> <span class="fu">ifelse</span>(posttiter <span class="sc">==</span> <span class="dv">0</span>, <span class="sc">-</span><span class="cn">Inf</span>, posttiter),</span>
<span id="cb12-29"><a href=""></a>        <span class="at">post_max =</span> <span class="fu">ifelse</span>(posttiter <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, posttiter <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb12-30"><a href=""></a>    )</span>
<span id="cb12-31"><a href=""></a></span>
<span id="cb12-32"><a href=""></a>hai_dat_interval <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(posttiter, post_min, post_max) <span class="sc">|&gt;</span></span>
<span id="cb12-34"><a href=""></a>    <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-35"><a href=""></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"interval2 format example"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<caption>interval2 format example</caption>
<thead>
<tr class="header">
<th style="text-align: right;">posttiter</th>
<th style="text-align: right;">post_min</th>
<th style="text-align: right;">post_max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>surv_fit_hai_interval2 <span class="ot">&lt;-</span></span>
<span id="cb13-2"><a href=""></a>    survival<span class="sc">::</span><span class="fu">survreg</span>(</span>
<span id="cb13-3"><a href=""></a>        survival<span class="sc">::</span><span class="fu">Surv</span>(post_min, post_max, <span class="at">type =</span> <span class="st">'interval2'</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb13-4"><a href=""></a>        <span class="at">data =</span> hai_dat_interval,</span>
<span id="cb13-5"><a href=""></a>        <span class="at">dist =</span> <span class="st">"gaussian"</span></span>
<span id="cb13-6"><a href=""></a>    )</span>
<span id="cb13-7"><a href=""></a></span>
<span id="cb13-8"><a href=""></a>hai_mean_int <span class="ot">&lt;-</span></span>
<span id="cb13-9"><a href=""></a>    broom<span class="sc">::</span><span class="fu">tidy</span>(surv_fit_hai_interval2, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-12"><a href=""></a>        <span class="at">y =</span> <span class="fu">hai_inverse</span>(estimate),</span>
<span id="cb13-13"><a href=""></a>        <span class="at">ymin =</span> <span class="fu">hai_inverse</span>(conf.low),</span>
<span id="cb13-14"><a href=""></a>        <span class="at">ymax =</span> <span class="fu">hai_inverse</span>(conf.high),</span>
<span id="cb13-15"><a href=""></a>        <span class="at">.keep =</span> <span class="st">"none"</span></span>
<span id="cb13-16"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-17"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"Interval censoring"</span>, <span class="at">.before =</span> <span class="fu">everything</span>())</span>
<span id="cb13-18"><a href=""></a></span>
<span id="cb13-19"><a href=""></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(hai_mean_naive, hai_mean_lod, hai_mean_int) <span class="sc">|&gt;</span></span>
<span id="cb13-20"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb13-21"><a href=""></a>        <span class="at">estimate =</span> y,</span>
<span id="cb13-22"><a href=""></a>        <span class="at">lower =</span> ymin,</span>
<span id="cb13-23"><a href=""></a>        <span class="at">upper =</span> ymax</span>
<span id="cb13-24"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-25"><a href=""></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">method</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">lower</th>
<th style="text-align: right;">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Naive</td>
<td style="text-align: right;">21.221</td>
<td style="text-align: right;">20.724</td>
<td style="text-align: right;">21.744</td>
</tr>
<tr class="even">
<td style="text-align: left;">LoD only</td>
<td style="text-align: right;">15.504</td>
<td style="text-align: right;">14.995</td>
<td style="text-align: right;">16.031</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Interval censoring</td>
<td style="text-align: right;">19.190</td>
<td style="text-align: right;">18.499</td>
<td style="text-align: right;">19.907</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Now let’s compare models for our actual research question, which is the effect of antigenic distance on the post-vaccination titer. That is, we want to summarize all of the individual antibody landscapes by fitting a line through them.</p></li>
<li><p>First, we’ll look at the naive fit, which doesn’t adjust for censoring.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>hai_simple_fit <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a href=""></a>    <span class="fu">lm</span>(</span>
<span id="cb14-3"><a href=""></a>        posttiter <span class="sc">~</span> norm_dist,</span>
<span id="cb14-4"><a href=""></a>        <span class="at">data =</span> hai_dat_interval</span>
<span id="cb14-5"><a href=""></a>    )</span>
<span id="cb14-6"><a href=""></a></span>
<span id="cb14-7"><a href=""></a>broom<span class="sc">::</span><span class="fu">tidy</span>(hai_simple_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)     4.12    0.0474      86.9       0
2 norm_dist      -2.89    0.0634     -45.5       0</code></pre>
</div>
</div>
<ul>
<li>Next we’ll look at a frequentist fit which adjusts for censoring using the survival package.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a>hai_surv_fit <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a href=""></a>        survival<span class="sc">::</span><span class="fu">survreg</span>(</span>
<span id="cb16-3"><a href=""></a>        survival<span class="sc">::</span><span class="fu">Surv</span>(post_min, post_max, <span class="at">type =</span> <span class="st">'interval2'</span>) <span class="sc">~</span> norm_dist,</span>
<span id="cb16-4"><a href=""></a>        <span class="at">data =</span> hai_dat_interval,</span>
<span id="cb16-5"><a href=""></a>        <span class="at">dist =</span> <span class="st">"gaussian"</span></span>
<span id="cb16-6"><a href=""></a>    )</span>
<span id="cb16-7"><a href=""></a></span>
<span id="cb16-8"><a href=""></a>broom<span class="sc">::</span><span class="fu">tidy</span>(hai_surv_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)    4.73    0.0707       67.0       0
2 norm_dist     -3.94    0.0958      -41.1       0
3 Log(scale)     0.936   0.00842     111.        0</code></pre>
</div>
</div>
<ul>
<li><p>Wow! When we do the interval censoring adjustment, the effect of antigenic distance is stronger than we thought under the naive model!</p></li>
<li><p>Next we’ll look at a Bayesian fit using <code>brms</code>. We have to do a bit more cleaning though because of the format that <code>brms</code> uses, which isn’t the same as <code>interval2</code> form.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>hai_dat_interval<span class="sc">$</span>cens <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href=""></a>    <span class="fu">ifelse</span>(hai_dat_interval<span class="sc">$</span>post_min <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="st">"left"</span>, <span class="st">"interval"</span>)</span>
<span id="cb18-3"><a href=""></a></span>
<span id="cb18-4"><a href=""></a>hai_dat_interval <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(posttiter, cens, post_max) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href=""></a>    <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href=""></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"brms censoring format"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<caption>brms censoring format</caption>
<thead>
<tr class="header">
<th style="text-align: right;">posttiter</th>
<th style="text-align: left;">cens</th>
<th style="text-align: right;">post_max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">interval</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: left;">left</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">left</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">interval</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">interval</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: left;">left</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a>hai_brms_fit <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href=""></a>    brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb19-3"><a href=""></a>        posttiter <span class="sc">|</span> <span class="fu">cens</span>(cens, post_max) <span class="sc">~</span> norm_dist,</span>
<span id="cb19-4"><a href=""></a>        <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb19-5"><a href=""></a>        <span class="at">data =</span> hai_dat_interval</span>
<span id="cb19-6"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.007092 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 70.92 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 28.077 seconds (Warm-up)
Chain 1:                26.848 seconds (Sampling)
Chain 1:                54.925 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 0.005919 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 59.19 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 28.435 seconds (Warm-up)
Chain 2:                27.909 seconds (Sampling)
Chain 2:                56.344 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 0.005914 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 59.14 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 30.109 seconds (Warm-up)
Chain 3:                25.397 seconds (Sampling)
Chain 3:                55.506 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 0.006433 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 64.33 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 27.687 seconds (Warm-up)
Chain 4:                29.666 seconds (Sampling)
Chain 4:                57.353 seconds (Total)
Chain 4: </code></pre>
</div>
</div>
<p>After sampling we can take a look at the model fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a><span class="fu">summary</span>(hai_brms_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: posttiter | cens(cens, post_max) ~ norm_dist 
   Data: hai_dat_interval (Number of observations: 11923) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     4.74      0.07     4.60     4.87 1.00     3269     3011
norm_dist    -3.94      0.10    -4.13    -3.75 1.00     3078     2808

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     2.55      0.02     2.51     2.59 1.00     3574     2651

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<ul>
<li>Finally we can do a fit using our own Stan code. This is a bit slower than the <code>brms</code> version because <code>brms</code> has a lot of Stan code improvements that speed up the code but are more difficult to read and write for me. However, if we include censored predictors we’ll be forced to write our own Stan code.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb23-1"><a href=""></a><span class="co">//</span></span>
<span id="cb23-2"><a href=""></a><span class="co">// Interval censoring in HAI titer outcome</span></span>
<span id="cb23-3"><a href=""></a><span class="co">// with one uncensored x value</span></span>
<span id="cb23-4"><a href=""></a><span class="co">// Zane Billings</span></span>
<span id="cb23-5"><a href=""></a><span class="co">// 2024-04-15</span></span>
<span id="cb23-6"><a href=""></a><span class="co">//</span></span>
<span id="cb23-7"><a href=""></a></span>
<span id="cb23-8"><a href=""></a><span class="co">// The input data include the number of observations N;</span></span>
<span id="cb23-9"><a href=""></a><span class="co">// a predictor variable x; and the lower limit y_l and upper limit y_u</span></span>
<span id="cb23-10"><a href=""></a><span class="co">// of the outcome in survival-like interval2 format.</span></span>
<span id="cb23-11"><a href=""></a><span class="co">// c is a vector of censoring statuses which is -1 for left censored, 0 for</span></span>
<span id="cb23-12"><a href=""></a><span class="co">// uncensored, 1 for right censored, 2 for interval censored, since stan</span></span>
<span id="cb23-13"><a href=""></a><span class="co">// will not permit evaluation of normal_lcdf() at infinite values</span></span>
<span id="cb23-14"><a href=""></a><span class="kw">data</span> {</span>
<span id="cb23-15"><a href=""></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;</span>
<span id="cb23-16"><a href=""></a>  <span class="dt">vector</span>[N] y_l;</span>
<span id="cb23-17"><a href=""></a>  <span class="dt">vector</span>[N] y_u;</span>
<span id="cb23-18"><a href=""></a>  <span class="dt">vector</span>[N] x;</span>
<span id="cb23-19"><a href=""></a>  <span class="dt">vector</span>[N] c;</span>
<span id="cb23-20"><a href=""></a>}</span>
<span id="cb23-21"><a href=""></a></span>
<span id="cb23-22"><a href=""></a><span class="co">// The parameters accepted by the model.</span></span>
<span id="cb23-23"><a href=""></a><span class="kw">parameters</span> {</span>
<span id="cb23-24"><a href=""></a>  <span class="dt">real</span> a;</span>
<span id="cb23-25"><a href=""></a>  <span class="dt">real</span> b;</span>
<span id="cb23-26"><a href=""></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb23-27"><a href=""></a>}</span>
<span id="cb23-28"><a href=""></a></span>
<span id="cb23-29"><a href=""></a><span class="co">// The model to be estimated.</span></span>
<span id="cb23-30"><a href=""></a><span class="kw">model</span> {</span>
<span id="cb23-31"><a href=""></a>	sigma ~ exponential(<span class="dv">1</span>);</span>
<span id="cb23-32"><a href=""></a>	a ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb23-33"><a href=""></a>	b ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb23-34"><a href=""></a>	</span>
<span id="cb23-35"><a href=""></a>	<span class="dt">vector</span>[N] mu;</span>
<span id="cb23-36"><a href=""></a>	<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb23-37"><a href=""></a>		<span class="co">// calculate the mean of the current observation</span></span>
<span id="cb23-38"><a href=""></a>		mu[i] = a + b * x[i];</span>
<span id="cb23-39"><a href=""></a>		<span class="co">// update the target likelihood appropriately depending on whether it is</span></span>
<span id="cb23-40"><a href=""></a>		<span class="co">// censored or not.</span></span>
<span id="cb23-41"><a href=""></a>		<span class="co">// No censoring case</span></span>
<span id="cb23-42"><a href=""></a>		<span class="cf">if</span> (c[i] == <span class="dv">0</span>)</span>
<span id="cb23-43"><a href=""></a>			<span class="kw">target +=</span> normal_lpdf(y_l[i] | mu[i], sigma);</span>
<span id="cb23-44"><a href=""></a>		<span class="cf">else</span> <span class="cf">if</span> (c[i] == -<span class="dv">1</span>)</span>
<span id="cb23-45"><a href=""></a>			<span class="kw">target +=</span> normal_lcdf(y_u[i] | mu[i], sigma);</span>
<span id="cb23-46"><a href=""></a>		<span class="cf">else</span> <span class="cf">if</span> (c[i] == <span class="dv">1</span>)</span>
<span id="cb23-47"><a href=""></a>			<span class="kw">target +=</span> normal_lccdf(y_l[i] | mu[i], sigma);</span>
<span id="cb23-48"><a href=""></a>		<span class="cf">else</span> <span class="cf">if</span> (c[i] == <span class="dv">2</span>)</span>
<span id="cb23-49"><a href=""></a>			<span class="kw">target +=</span> log_diff_exp(</span>
<span id="cb23-50"><a href=""></a>				normal_lcdf(y_u[i] | mu[i], sigma),</span>
<span id="cb23-51"><a href=""></a>				normal_lcdf(y_l[i] | mu[i], sigma)</span>
<span id="cb23-52"><a href=""></a>			);</span>
<span id="cb23-53"><a href=""></a>	}</span>
<span id="cb23-54"><a href=""></a>}</span>
<span id="cb23-55"><a href=""></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First we have to compile the Stan code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>mod_pth <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"stan"</span>, <span class="st">"hai-censored-outcome.stan"</span>)</span>
<span id="cb24-2"><a href=""></a>hai_stan_mod <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">cmdstan_model</span>(mod_pth, <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-3"><a href=""></a>hai_stan_mod<span class="sc">$</span><span class="fu">compile</span>(<span class="at">pedantic =</span> <span class="cn">TRUE</span>, <span class="at">force_recompile =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also have to format our data in a specific way for Stan. Stan only accepts numeric variables, and the input needs to be a list because the inputs can vary in length.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a>hai_stan_dat <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href=""></a>    hai_dat_interval <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb25-4"><a href=""></a>        <span class="at">x =</span> norm_dist,</span>
<span id="cb25-5"><a href=""></a>        <span class="at">y_l =</span> post_min,</span>
<span id="cb25-6"><a href=""></a>        <span class="at">y_u =</span> post_max,</span>
<span id="cb25-7"><a href=""></a>        <span class="at">c =</span> cens</span>
<span id="cb25-8"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb25-9"><a href=""></a>    <span class="co"># Convert cens to integer following brms convention</span></span>
<span id="cb25-10"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb25-11"><a href=""></a>        <span class="at">c =</span> <span class="fu">ifelse</span>(c <span class="sc">==</span> <span class="st">"left"</span>, <span class="sc">-</span><span class="dv">1</span>L, <span class="dv">2</span>L)</span>
<span id="cb25-12"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb25-13"><a href=""></a>    <span class="fu">as.list</span>()</span>
<span id="cb25-14"><a href=""></a>hai_stan_dat<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hai_dat_interval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can sample from the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a>hai_stan_fit <span class="ot">&lt;-</span> hai_stan_mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb26-2"><a href=""></a>    hai_stan_dat,</span>
<span id="cb26-3"><a href=""></a>    <span class="at">seed =</span> <span class="dv">923154</span>,</span>
<span id="cb26-4"><a href=""></a>    <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb26-5"><a href=""></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb26-6"><a href=""></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span></span>
<span id="cb26-7"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 89.4 seconds.
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 92.4 seconds.
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 95.4 seconds.
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 98.3 seconds.

All 4 chains finished successfully.
Mean chain execution time: 93.9 seconds.
Total execution time: 98.6 seconds.</code></pre>
</div>
</div>
<p>And finally we can check the model fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a>hai_stan_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> variable      mean    median   sd  mad        q5       q95 rhat ess_bulk
    lp__  -23099.66 -23099.30 1.23 1.04 -23102.00 -23098.30 1.00     1445
    a          4.72      4.73 0.07 0.07      4.60      4.84 1.00     1362
    b         -3.93     -3.93 0.10 0.10     -4.09     -3.76 1.00     1374
    sigma      2.55      2.55 0.02 0.02      2.51      2.58 1.00     1844
 ess_tail
     2089
     1427
     1287
     1828</code></pre>
</div>
</div>
</section>
<section id="dealing-with-censored-predictors" class="slide level2">
<h2>Dealing with censored predictors</h2>
<ul>
<li>Now, we might also want to deal with a censored predictor. Unfortunately, this is more difficult than dealing with a censored outcome.</li>
<li>In a standard linear regression model, <strong>we assume the predictors are constant</strong>. So if we want to incorporate censoring, we have to assume they can be observed with some type of error.</li>
<li>The easiest way to do this is to assume a parametric model for the predictor, e.g.</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mathrm{Normal}\left(\alpha + \beta \cdot x_i, \sigma^2\right) \\
x_i &amp;\sim \mathrm{Normal}\left(\mu_x, \sigma^2_x\right)
\end{aligned}
\]</span></p>
<ul>
<li><strong>This specific model is not identifiable without further constraints!</strong></li>
<li>If we assume that the <span class="math inline">\(y_i\)</span> are conditionally independent of <span class="math inline">\(x_i\)</span> (this is the typical linear regression assumption), then</li>
</ul>
<p><span class="math display">\[
\mathcal{L}\left(\theta \mid x, y\right) = \prod_{i=1}^n f_X(x \mid \theta)\cdot f_{Y \mid X}\left(y \mid \theta, X = x\right).
\]</span></p>
<ul>
<li>The main issue here is that’s not necessarily true, because</li>
</ul>
<p><span class="math display">\[
f_{X, Y}(x, y) \neq f_X(x)\cdot f_Y(y)
\]</span> in general.</p>
<ul>
<li>Usually people are OK with assuming that <span class="math inline">\(x\)</span> is a constant, even when that doesn’t make sense, so I’m pretty much fine with assuming marginal independence.</li>
<li>However, there’s also the option of using a <a href="https://en.wikipedia.org/wiki/Copula_(probability_theory)">copula function</a> to construct the joint likelihood, which is not too hard if you use a Bayesian model. But choosing a copula is a whole additional issue.</li>
<li><strong>This likelihood can be hard to optimize.</strong> AFAIK, there are not any packages for <code>R</code> that deal with censored predictors in a frequentist perspective, although you could numerically optimize it. You could also get CIs using bootstrapping or maybe a profile method.</li>
<li>However, joint modeling of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> is not too difficult to do in Stan, so that’s the approach we’ll take.</li>
</ul>
</section>
<section id="example-2-norovirus" class="slide level2">
<h2>Example 2: norovirus</h2>
<ul>
<li>This is one of Savannah’s current projects, so I don’t know too much about the data.</li>
<li>But it’s from a norovirus vaccine clinical trial, and I’ll be looking at the effect of an antibody on the outcome, including an interaction with the effect of the treatment.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a>nov_dat <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"nov-clean.Rds"</span>))</span>
<span id="cb30-2"><a href=""></a></span>
<span id="cb30-3"><a href=""></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(nov_dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 107
Columns: 3
$ treatment &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, …
$ protected &lt;dbl&gt; 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, …
$ gii_pgm   &lt;dbl&gt; 1569.318, 566.593, 946.028, 570.214, 1335.983, 505.337, 291.…</code></pre>
</div>
</div>
<ul>
<li>All I really know about the data is that a bunch of people got the candidate vaccine, then got norovirus challenged, and they were followed up to see if they got infected. Savannah knows all the details about the antibody assay I’m looking at and the timing and stuff. Those details aren’t really necessary for what I’m trying to do here.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a><span class="fu">ggplot</span>(nov_dat) <span class="sc">+</span></span>
<span id="cb32-2"><a href=""></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(gii_pgm), <span class="at">y =</span> protected, <span class="at">color =</span> <span class="fu">factor</span>(treatment)) <span class="sc">+</span></span>
<span id="cb32-3"><a href=""></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.15</span>, <span class="at">width =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="main_files/figure-revealjs/nov%20dat%20plot-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Since there is a big clump of values at <span class="math inline">\(92\)</span>, we’ll use that as the limit of detection for the assay, although I think Savannah had some other issues with the LoD. However, for our purposes this will just be a left-censored predictor with the LoD at <span class="math inline">\(92\)</span>.</li>
<li>Explain the model:</li>
</ul>
<p><span class="math display">\[
\begin{align*}
y_i &amp;\sim \text{Bernoulli}\left(p_i\right) \\
\mathrm{logit}(p_i) &amp;= \beta_{1, T[i]} + \beta_{2, T[i]} \cdot \log\left(x^*_i\right)\\
\log\left(x_i^*\right) &amp;\sim \mathrm{Normal}\left(\mu_x, \sigma^2_x\right) \\
\mu_x &amp;= \alpha_{T[i]} \\
x_i &amp;= \begin{cases}
U, &amp; x^*_i \leq \mathrm{LoD} \\
x^*_i, &amp; x^*_i &gt; \mathrm{LoD}
\end{cases} \\
T[i] &amp;= \begin{cases}
1, &amp; \text{individual } i \text{ is in the placebo group} \\
2, &amp; \text{individual } i \text{ is in the vaccine group}
\end{cases}
\end{align*}
\]</span></p>
<ul>
<li><p>Because the effect of <span class="math inline">\(x\)</span> is group-dependent, parametrizing this in a frequentist way is really very difficult and there is not a director comparison to a <code>glm()</code>-type method.</p></li>
<li><p>We need to do a bit of set up with our data set.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href=""></a>nov_stan_dat <span class="ot">&lt;-</span></span>
<span id="cb33-2"><a href=""></a>    nov_dat <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb33-4"><a href=""></a>        <span class="at">t =</span> treatment <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb33-5"><a href=""></a>        <span class="at">x =</span> <span class="fu">log</span>(gii_pgm),</span>
<span id="cb33-6"><a href=""></a>        <span class="at">y =</span> protected,</span>
<span id="cb33-7"><a href=""></a>        <span class="at">.keep =</span> <span class="st">"none"</span></span>
<span id="cb33-8"><a href=""></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb33-9"><a href=""></a>    <span class="fu">as.list</span>()</span>
<span id="cb33-10"><a href=""></a>nov_stan_dat<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nov_dat)</span>
<span id="cb33-11"><a href=""></a>nov_stan_dat<span class="sc">$</span>k <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb33-12"><a href=""></a></span>
<span id="cb33-13"><a href=""></a><span class="co"># Version of data where model doesn't implement censoring</span></span>
<span id="cb33-14"><a href=""></a>nov_stan_dat_naive <span class="ot">&lt;-</span> nov_stan_dat</span>
<span id="cb33-15"><a href=""></a>nov_stan_dat_naive<span class="sc">$</span>x_l <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> nov_stan_dat<span class="sc">$</span>N)</span>
<span id="cb33-16"><a href=""></a></span>
<span id="cb33-17"><a href=""></a><span class="co"># Version of data where model DOES implement censoring</span></span>
<span id="cb33-18"><a href=""></a>nov_stan_dat_cens <span class="ot">&lt;-</span> nov_stan_dat</span>
<span id="cb33-19"><a href=""></a>nov_stan_dat_cens<span class="sc">$</span>x_l <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">log</span>(<span class="dv">92</span>), <span class="at">times =</span> nov_stan_dat<span class="sc">$</span>N)</span>
<span id="cb33-20"><a href=""></a></span>
<span id="cb33-21"><a href=""></a><span class="fu">str</span>(nov_stan_dat_cens, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ t  : num [1:107] 2 2 2 2 2 2 1 1 2 1 ...
 $ x  : num [1:107] 7.36 6.34 6.85 6.35 7.2 ...
 $ y  : num [1:107] 0 1 1 1 0 1 1 1 1 1 ...
 $ N  : int 107
 $ k  : num 2
 $ x_l: num [1:107] 4.52 4.52 4.52 4.52 4.52 ...</code></pre>
</div>
</div>
<ul>
<li>Let’s take a look at the Stan code that implements the model.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb35-1"><a href=""></a><span class="co">//</span></span>
<span id="cb35-2"><a href=""></a><span class="co">// Logistic regression for norovirus example</span></span>
<span id="cb35-3"><a href=""></a><span class="co">// where the antibody predictor is censored</span></span>
<span id="cb35-4"><a href=""></a><span class="co">// Zane Billings</span></span>
<span id="cb35-5"><a href=""></a><span class="co">// 2024-04-15</span></span>
<span id="cb35-6"><a href=""></a><span class="co">//</span></span>
<span id="cb35-7"><a href=""></a></span>
<span id="cb35-8"><a href=""></a><span class="co">// Data that must be passed in by the user</span></span>
<span id="cb35-9"><a href=""></a>	<span class="co">// N:</span></span>
<span id="cb35-10"><a href=""></a>		<span class="co">// a positive integer, the number of (X, y) observations.</span></span>
<span id="cb35-11"><a href=""></a>	<span class="co">// k:</span></span>
<span id="cb35-12"><a href=""></a>		<span class="co">// a positive integer, the number of treatment groups.</span></span>
<span id="cb35-13"><a href=""></a>	<span class="co">// t:</span></span>
<span id="cb35-14"><a href=""></a>		<span class="co">// a 1D integer array of size [N], contained to be in 1, 2, ..., k.</span></span>
<span id="cb35-15"><a href=""></a>		<span class="co">// t[i] is the treatment group of the i-th individual.</span></span>
<span id="cb35-16"><a href=""></a>	<span class="co">// y:</span></span>
<span id="cb35-17"><a href=""></a>		<span class="co">// a 1D integer array of size [N], constrained to be 0 or 1. This is the</span></span>
<span id="cb35-18"><a href=""></a>		<span class="co">// binary outcome variable.</span></span>
<span id="cb35-19"><a href=""></a>	<span class="co">// x:</span></span>
<span id="cb35-20"><a href=""></a>		<span class="co">// a 1D real array of size [N]. Contains the observed values of the</span></span>
<span id="cb35-21"><a href=""></a>		<span class="co">// predictor variable.</span></span>
<span id="cb35-22"><a href=""></a>	<span class="co">// x_l:</span></span>
<span id="cb35-23"><a href=""></a>		<span class="co">// a 1D real array of size [N]. Contains the lower limit of detection for</span></span>
<span id="cb35-24"><a href=""></a>		<span class="co">// the corresponding entry in x, therefore allowing the LoD to change across</span></span>
<span id="cb35-25"><a href=""></a>		<span class="co">// different measurements.</span></span>
<span id="cb35-26"><a href=""></a><span class="kw">data</span> {</span>
<span id="cb35-27"><a href=""></a>	<span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;</span>
<span id="cb35-28"><a href=""></a>	<span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; k;</span>
<span id="cb35-29"><a href=""></a>	<span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=k&gt; t;</span>
<span id="cb35-30"><a href=""></a>	<span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; y;</span>
<span id="cb35-31"><a href=""></a>	<span class="dt">array</span>[N] <span class="dt">real</span> x;</span>
<span id="cb35-32"><a href=""></a>	<span class="dt">array</span>[N] <span class="dt">real</span> x_l;</span>
<span id="cb35-33"><a href=""></a>}</span>
<span id="cb35-34"><a href=""></a></span>
<span id="cb35-35"><a href=""></a><span class="co">// Model parameters</span></span>
<span id="cb35-36"><a href=""></a><span class="kw">parameters</span> {</span>
<span id="cb35-37"><a href=""></a>	<span class="co">// Parameters in model for x</span></span>
<span id="cb35-38"><a href=""></a>	<span class="co">//real alpha_0;</span></span>
<span id="cb35-39"><a href=""></a>	<span class="dt">array</span>[k] <span class="dt">real</span> alpha_1;</span>
<span id="cb35-40"><a href=""></a>	<span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_x;</span>
<span id="cb35-41"><a href=""></a>	</span>
<span id="cb35-42"><a href=""></a>	<span class="co">// Parameters in model for y</span></span>
<span id="cb35-43"><a href=""></a>	<span class="co">//real beta_0;</span></span>
<span id="cb35-44"><a href=""></a>	<span class="dt">array</span>[k] <span class="dt">real</span> beta_1;</span>
<span id="cb35-45"><a href=""></a>	<span class="dt">array</span>[k] <span class="dt">real</span> beta_2;</span>
<span id="cb35-46"><a href=""></a>}</span>
<span id="cb35-47"><a href=""></a></span>
<span id="cb35-48"><a href=""></a><span class="co">// The model</span></span>
<span id="cb35-49"><a href=""></a><span class="kw">model</span> {</span>
<span id="cb35-50"><a href=""></a>	<span class="co">// Declare vectors of p and mu values</span></span>
<span id="cb35-51"><a href=""></a>	<span class="dt">vector</span>[N] p;</span>
<span id="cb35-52"><a href=""></a>	<span class="dt">vector</span>[N] mu;</span>
<span id="cb35-53"><a href=""></a>	</span>
<span id="cb35-54"><a href=""></a>	<span class="co">// Priors</span></span>
<span id="cb35-55"><a href=""></a>	<span class="co">//alpha_0 ~ normal(0, 2);</span></span>
<span id="cb35-56"><a href=""></a>	alpha_1 ~ normal(<span class="dv">0</span>, <span class="dv">2</span>); <span class="co">//Nb we could use MVN dist here if desired</span></span>
<span id="cb35-57"><a href=""></a>	sigma_x ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb35-58"><a href=""></a>	<span class="co">//beta_0 ~ normal(0, 2);</span></span>
<span id="cb35-59"><a href=""></a>	beta_1 ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb35-60"><a href=""></a>	beta_2 ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb35-61"><a href=""></a>	</span>
<span id="cb35-62"><a href=""></a>	<span class="co">// Likelihood updating</span></span>
<span id="cb35-63"><a href=""></a>	<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb35-64"><a href=""></a>		<span class="co">// Calculate the mean of x[i] based on alpha distributions</span></span>
<span id="cb35-65"><a href=""></a>		mu[i] = alpha_1[t[i]];</span>
<span id="cb35-66"><a href=""></a>		</span>
<span id="cb35-67"><a href=""></a>		<span class="co">// Model x, accounting for censoring. Assuming a normal distribution (and</span></span>
<span id="cb35-68"><a href=""></a>		<span class="co">// thus for our purposes, x is already log-transformed) with mean mu_x and</span></span>
<span id="cb35-69"><a href=""></a>		<span class="co">// standard deviation sigma_x.</span></span>
<span id="cb35-70"><a href=""></a>		<span class="cf">if</span> (x[i] &lt;= x_l[i]) {</span>
<span id="cb35-71"><a href=""></a>			<span class="kw">target +=</span> normal_lcdf(x_l[i] | mu[i], sigma_x);</span>
<span id="cb35-72"><a href=""></a>		} <span class="cf">else</span> {</span>
<span id="cb35-73"><a href=""></a>			x[i] ~ normal(mu[i], sigma_x);</span>
<span id="cb35-74"><a href=""></a>		}</span>
<span id="cb35-75"><a href=""></a>		</span>
<span id="cb35-76"><a href=""></a>		<span class="co">// Now calculate the linear model part -- we do this explicitly for</span></span>
<span id="cb35-77"><a href=""></a>		<span class="co">// readability and direct correspondence to the statistical model.</span></span>
<span id="cb35-78"><a href=""></a>		p[i] = beta_1[t[i]] + beta_2[t[i]] * x[i];</span>
<span id="cb35-79"><a href=""></a>		</span>
<span id="cb35-80"><a href=""></a>		<span class="co">// And finally update the model for y[i].</span></span>
<span id="cb35-81"><a href=""></a>		y[i] ~ bernoulli_logit(p[i]);</span>
<span id="cb35-82"><a href=""></a>	}</span>
<span id="cb35-83"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We need to compile the stan code that implements this model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a><span class="co"># Compile the stan model</span></span>
<span id="cb36-2"><a href=""></a>nov_mod_pth <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"stan"</span>, <span class="st">"nov-censored-predictor.stan"</span>)</span>
<span id="cb36-3"><a href=""></a>nov_stan_mod <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">cmdstan_model</span>(nov_mod_pth, <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-4"><a href=""></a>nov_stan_mod<span class="sc">$</span><span class="fu">compile</span>(<span class="at">pedantic =</span> <span class="cn">TRUE</span>, <span class="at">force_recompile =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Since there’s no frequentist model to compare to, let’s first run the model without a correction for censoring.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a>nov_stan_fit_naive <span class="ot">&lt;-</span> nov_stan_mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb37-2"><a href=""></a>    nov_stan_dat_naive,</span>
<span id="cb37-3"><a href=""></a>    <span class="at">seed =</span> <span class="dv">923154</span>,</span>
<span id="cb37-4"><a href=""></a>    <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb37-5"><a href=""></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb37-6"><a href=""></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span></span>
<span id="cb37-7"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 2.3 seconds.
Chain 3 finished in 2.2 seconds.
Chain 4 finished in 2.2 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 2.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 2.3 seconds.
Total execution time: 2.6 seconds.</code></pre>
</div>
</div>
<p>We’ll take a look at the model estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a>nov_stan_fit_naive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   variable   mean median   sd  mad     q5    q95 rhat ess_bulk ess_tail
 lp__       -95.66 -95.38 1.85 1.77 -99.11 -93.25 1.00     1718     2533
 alpha_1[1]   4.89   4.89 0.10 0.10   4.73   5.05 1.00     4370     2649
 alpha_1[2]   6.65   6.65 0.10 0.10   6.49   6.80 1.00     3853     2518
 sigma_x      0.70   0.69 0.05 0.05   0.62   0.78 1.00     4719     2881
 beta_1[1]   -3.68  -3.68 1.42 1.42  -5.99  -1.40 1.00     2307     2468
 beta_1[2]    0.32   0.37 1.63 1.62  -2.34   3.00 1.00     1850     2124
 beta_2[1]    0.68   0.68 0.29 0.30   0.21   1.17 1.00     2323     2470
 beta_2[2]   -0.07  -0.07 0.25 0.25  -0.47   0.34 1.00     1865     2219</code></pre>
</div>
</div>
<ul>
<li>Now we can run the model with the censoring correction.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a>nov_stan_fit_cens <span class="ot">&lt;-</span> nov_stan_mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb41-2"><a href=""></a>    nov_stan_dat_cens,</span>
<span id="cb41-3"><a href=""></a>    <span class="at">seed =</span> <span class="dv">923154</span>,</span>
<span id="cb41-4"><a href=""></a>    <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb41-5"><a href=""></a>    <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb41-6"><a href=""></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span></span>
<span id="cb41-7"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 1 finished in 2.4 seconds.
Chain 2 finished in 2.4 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
Chain 3 finished in 2.5 seconds.
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 2.6 seconds.

All 4 chains finished successfully.
Mean chain execution time: 2.5 seconds.
Total execution time: 2.8 seconds.</code></pre>
</div>
</div>
<p>And we can look at the estimates with the censoring correction – notably our effect of the treatment estimates doesn’t seem to change, but some of the others change a bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a>nov_stan_fit_cens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   variable    mean  median   sd  mad      q5     q95 rhat ess_bulk ess_tail
 lp__       -133.19 -132.83 1.87 1.69 -136.66 -130.78 1.00     1760     2390
 alpha_1[1]    4.35    4.36 0.16 0.15    4.08    4.60 1.00     3204     2577
 alpha_1[2]    6.64    6.64 0.13 0.13    6.43    6.85 1.00     3988     2836
 sigma_x       0.94    0.94 0.09 0.08    0.81    1.09 1.00     3208     2433
 beta_1[1]    -3.61   -3.59 1.51 1.57   -6.13   -1.17 1.00     2410     2219
 beta_1[2]     0.31    0.28 1.65 1.67   -2.38    3.05 1.00     2006     1695
 beta_2[1]     0.67    0.67 0.31 0.32    0.17    1.20 1.00     2460     2359
 beta_2[2]    -0.06   -0.06 0.25 0.25   -0.48    0.34 1.00     1890     1845</code></pre>
</div>
</div>
</section>
<section id="math-on-censored-variables" class="slide level2">
<h2>Math on censored variables</h2>
<p>For HAI score and other accepted surrogate endpoints in clinical trials, we would like to analyze the change from baseline directly as the outcome of our model. For HAI, this usually called the fold change on the natural scale or the titer increase on the log scale. We can compute this as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a>hai_dat<span class="sc">$</span>titer_increase <span class="ot">&lt;-</span> hai_dat<span class="sc">$</span>posttiter <span class="sc">-</span> hai_dat<span class="sc">$</span>pretiter</span>
<span id="cb45-2"><a href=""></a>hai_dat<span class="sc">$</span>fold_change <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">^</span> hai_dat<span class="sc">$</span>titer_increase</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notably, these two values both involve doing math on a censored variable, so it is not immediately obvious how to deal with censoring in these outcomes. For the fold change, we consider the following cases.</p>
<table>
<colgroup>
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 39%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Pre-titer</th>
<th style="text-align: center;">Post-titer</th>
<th>Censored?</th>
<th style="text-align: center;">Fold change (lower bound)</th>
<th>Fold change (upper bound)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math display">\[&lt;10\]</span></td>
<td style="text-align: center;"><span class="math display">\[&lt;10\]</span></td>
<td>Yes</td>
<td style="text-align: center;"><span class="math display">\[\lim_{b\to 0} \frac{\text{post}}{b} = 0\]</span></td>
<td><span class="math display">\[\lim_{a\to 0} \frac{a}{\text{pre}} = \infty\]</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math display">\[&lt;10\]</span></td>
<td style="text-align: center;"><span class="math display">\[\geq 10\]</span></td>
<td>Yes</td>
<td style="text-align: center;"><span class="math display">\[\lim_{b\to 10} \frac{\text{post}}{b} = \frac{\text{post}}{10}\]</span></td>
<td><span class="math display">\[\lim_{b\to 0} \frac{\text{post}}{b} = \infty\]</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math display">\[\geq 10\]</span></td>
<td style="text-align: center;"><span class="math display">\[&lt;10\]</span></td>
<td>Yes</td>
<td style="text-align: center;"><span class="math display">\[\lim_{a\to 0}\frac{a}{\text{pre}} = 0\]</span></td>
<td><span class="math display">\[\lim_{a\to 10}\frac{a}{\text{pre}} = \frac{10}{\text{pre}}\]</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math display">\[\geq 10\]</span></td>
<td style="text-align: center;"><span class="math display">\[\geq 10\]</span></td>
<td>No</td>
<td style="text-align: center;"><span class="math display">\[\frac{\text{post}}{\text{pre}}\]</span></td>
<td><span class="math display">\[\frac{\text{post}}{\text{pre}}\]</span></td>
</tr>
</tbody>
</table>
<p>Taking <span class="math inline">\(\lim_{a\to 0} \log(a) = -\infty\)</span> and <span class="math inline">\(\lim_{a\to \infty} \log(a) = \infty\)</span>, we can get the equivalent bounds for the titer increase. We can then implement models with the fold change or titer increase as the outcome. However, note that this reduces our effective sample size for the process of estimation, because any values where both the pre-titer and post-titer are censored span the entire domain, and thus contribute nothing to the likelihood. This results as a consequence of the indeterminate form <span class="math inline">\(\frac{0}{0}\)</span> appearing in the limit.</p>
<p>Modeling the post-titer and pre-titer separately or jointly rather than modeling the change will better account for censoring without the issue of this indeterminate form.</p>
<!-- END OF FILE -->
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="main_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="main_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="main_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="main_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="main_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="main_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="main_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="main_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="main_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="main_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>